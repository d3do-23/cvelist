## Summary

The `gpt_academic` project contains a path traversal vulnerability in its `merge_tex_files_` function, which is responsible for processing LaTeX files. The function fails to properly sanitize or restrict file paths specified within the `\input{}` directive. An attacker can craft a malicious `.tex` file with directory traversal sequences (e.g., `../`) to read arbitrary files from the server or local filesystem where the application is running.

## Vulnerability Description and Analysis

`gpt_academic` provides several features based on LaTeX processing, such as the plugin "Latex English proofreading + highlight corrections" (Latex英文纠错+高亮修正位置). These features rely on a function named `merge_tex_files_` to recursively resolve and merge files referenced by the `\input{}` command within a `.tex` project.

The root cause of the vulnerability lies in the following code snippet:

```python
def merge_tex_files_(project_foler, main_file, mode):
    """
    Merge Tex project recursively
    """
    main_file = rm_comments(main_file)
    for s in reversed([q for q in re.finditer(r"\\input\{(.*?)\}", main_file, re.M)]):
        f = s.group(1)
        # Vulnerable line: The user-controlled path 'f' is directly joined with the base project folder.
        fp = os.path.join(project_foler, f)
        fp_ = find_tex_file_ignore_case(fp)
        if fp_:
            try:
                # The constructed path is opened here without any security checks.
                with open(fp_, "r", encoding="utf-8", errors="replace") as fx:
                    c = fx.read()
            # ...
```

The code extracts the file path `f` from an `\input{}` directive and constructs a full path using `os.path.join(project_foler, f)`. Since the input `f` is fully user-controlled and not sanitized, an attacker can include path traversal payloads like `../` to navigate outside the intended project directory and access any file on the filesystem.

## Impact

By uploading a specially crafted `.tex` file, an attacker can exploit this vulnerability to read sensitive files from the host system. This includes configuration files, source code, user data, SSH keys, or system files like `/etc/passwd`, leading to a severe information disclosure.

## Proof of Concept (PoC)

1.  Create a file named `malicious.tex` with the following content:
    ```latex
    \documentclass{article}
    \begin{document}
    My secret data:
    \input{../../../../../../../../../../../../../etc/passwd}
    \end{document}
    ```

2.  Upload this `malicious.tex` file within the `gpt_academic` application.

<img width="1868" height="610" alt="image_gpt1" src="https://github.com/d3do-23/cvelist/blob/main/gpt_academic/lfi_0.png" />

3.  Trigger the vulnerable processing logic by using a relevant plugin, such as "Latex English proofreading + highlight corrections."
<img width="1928" height="1156" alt="imagegpt3" src="https://github.com/d3do-23/cvelist/blob/main/gpt_academic/lfi_1.png" />

**Expected Result:**
The output generated by the plugin (often an HTML file) will contain the contents of the `/etc/passwd` file, confirming the successful arbitrary file read.
<img width="3152" height="1708" alt="imagegpt4" src="https://github.com/d3do-23/cvelist/blob/main/gpt_academic/lfi_2.png" />

## Remediation Suggestion

The path provided in the `\input{}` command must be strictly validated and sanitized before any file I/O operations. The application must ensure that the resolved, absolute path of the target file is confined within the intended project directory.

A robust fix would involve the following steps:
```
1.  Get the canonical absolute path of the base directory (`project_foler`) and the target file (`fp`) using a function like `os.path.abspath()`.
2.  Check if the resolved absolute path of the target file starts with the resolved absolute path of the base directory.
3.  If the check fails, reject the file-read request and raise an error.
```

## Credits

Wenhao Wu, ChengGao, Alibaba Cloud Intelligence Security Team
